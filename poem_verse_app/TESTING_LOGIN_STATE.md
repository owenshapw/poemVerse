# 登录状态持久化功能测试指南

## 测试前准备

1. 确保已安装所有依赖：
```bash
cd poem_verse_app
flutter pub get
```

2. 运行应用

## 测试场景

### 场景1：首次安装和启动
**预期行为：** 应显示欢迎页（LocalHomeScreen）

**测试步骤：**
1. 卸载并重新安装APP
2. 启动应用
3. 观察：应该看到启动动画后跳转到欢迎页

**通过标准：** ✅ 显示欢迎页面，有"开始创作"等引导按钮

---

### 场景2：非首次启动（未登录）
**预期行为：** 应显示本地作品列表（LocalPoemsScreen）

**测试步骤：**
1. 首次启动后，完全关闭APP
2. 再次打开APP
3. 观察：应该直接跳转到"本地诗篇"页面

**通过标准：** ✅ 直接进入本地作品列表页，标题显示"本地诗篇"

---

### 场景3：登录成功
**预期行为：** 登录成功后跳转到个人作品列表，并保存登录状态

**测试步骤：**
1. 在"本地诗篇"页面点击登录按钮
2. 输入正确的邮箱和密码
3. 点击登录
4. 观察：
   - 应该显示"登录中，正在同步本地作品..."提示
   - 登录成功后显示"✅ 登录成功！本地作品已同步到云端"
   - 自动跳转到"我的诗篇"页面

**通过标准：** 
- ✅ 显示同步提示
- ✅ 跳转到个人作品列表
- ✅ 标题显示"我的诗篇"

---

### 场景4：登录后重启APP
**预期行为：** 应直接进入个人作品列表，无需重新登录

**测试步骤：**
1. 在已登录状态下完全关闭APP
2. 重新打开APP
3. 观察：应该直接跳转到"我的诗篇"页面

**通过标准：** 
- ✅ 直接进入"我的诗篇"页面
- ✅ 无需重新登录
- ✅ 可以看到自己的作品

**调试提示：**
查看控制台日志，应该看到：
```
已恢复登录状态: [用户名]
检测到已登录状态，跳转到个人作品页
```

---

### 场景5：退出登录
**预期行为：** 退出后清除登录状态，跳转到欢迎页

**测试步骤：**
1. 在"我的诗篇"页面点击右上角退出登录按钮
2. 确认退出
3. 观察：应该跳转到欢迎页（LocalHomeScreen）

**通过标准：** ✅ 跳转到欢迎页面

---

### 场景6：退出登录后重启APP
**预期行为：** 应显示本地作品列表（未登录状态）

**测试步骤：**
1. 退出登录后，完全关闭APP
2. 重新打开APP
3. 观察：应该跳转到"本地诗篇"页面

**通过标准：** 
- ✅ 显示"本地诗篇"页面
- ✅ 需要重新登录才能访问云端作品

**调试提示：**
查看控制台日志，应该看到：
```
未找到保存的登录状态
未检测到登录状态，跳转到本地作品页
```

---

### 场景7：本地作品同步
**预期行为：** 登录时自动同步本地未同步的作品

**测试步骤：**
1. 在未登录状态下创建几首本地作品
2. 登录账号
3. 观察控制台日志
4. 进入"我的诗篇"页面查看

**通过标准：** 
- ✅ 控制台显示同步进度（如：成功同步 3 首作品到云端）
- ✅ 在"我的诗篇"可以看到刚才创建的本地作品
- ✅ 本地作品的同步标记变为已同步

**调试日志示例：**
```
登录成功，开始同步本地作品...
找到 3 首未同步的作品
正在同步作品 "xxx"
同步完成: 3/3 首作品成功
```

---

### 场景8：切换账号
**预期行为：** 可以退出并登录另一个账号

**测试步骤：**
1. 使用账号A登录
2. 退出登录
3. 使用账号B登录
4. 观察：应该显示账号B的作品

**通过标准：** 
- ✅ 成功切换到账号B
- ✅ 显示账号B的作品列表
- ✅ 重启APP后仍然是账号B的登录状态

---

## 常见问题排查

### 问题1：重启APP后仍需要登录
**可能原因：** SharedPreferences 没有正确保存

**排查步骤：**
1. 检查控制台是否有"登录状态已保存"日志
2. 检查是否有权限问题
3. 尝试重新安装APP

### 问题2：登录后看不到本地作品
**可能原因：** 同步失败或网络问题

**排查步骤：**
1. 查看控制台的同步日志
2. 检查网络连接
3. 查看"本地诗篇"页面，未同步的作品会显示云朵图标

### 问题3：退出登录后无法再次登录
**可能原因：** 网络问题或服务器问题

**排查步骤：**
1. 检查网络连接
2. 查看控制台错误日志
3. 确认服务器状态

---

## 成功标准总结

所有以下场景都应该通过测试：

- ✅ 首次启动显示欢迎页
- ✅ 非首次启动（未登录）显示本地作品列表
- ✅ 登录成功后跳转到个人作品列表
- ✅ 登录后重启APP保持登录状态
- ✅ 退出登录清除状态并跳转欢迎页
- ✅ 退出后重启APP显示未登录状态
- ✅ 本地作品自动同步到云端
- ✅ 可以切换不同账号

---

## 测试完成checklist

- [ ] 场景1：首次安装和启动
- [ ] 场景2：非首次启动（未登录）
- [ ] 场景3：登录成功
- [ ] 场景4：登录后重启APP
- [ ] 场景5：退出登录
- [ ] 场景6：退出登录后重启APP
- [ ] 场景7：本地作品同步
- [ ] 场景8：切换账号

测试人员：___________
测试日期：___________
测试结果：通过 / 未通过
